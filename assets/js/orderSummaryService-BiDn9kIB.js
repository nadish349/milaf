import{r as e}from"./vendor-CyyySG0f.js";import{n as t,q as a,w as s,B as r,t as o}from"./firebase-rYhY7HPw.js";import{e as i,b as n,a as c,g as d}from"./index-jHmpFEMT.js";import{g as u}from"./productImages-BIVgD51t.js";import{m as p}from"./milafcola-BJYXYRQ2.js";const l=()=>{const{user:l}=n(),{cartItems:m,loadUserCart:D}=c(),[y,g]=e.useState([]),[f,h]=e.useState(!1),[C,w]=e.useState([]);e.useEffect(()=>{(async()=>{const e=await Promise.all(m.map(async e=>{const t=await(async e=>{if(!0===e.cases)try{const t=await d(e.name);if(t&&t.casePrice)return t.casePrice}catch(t){}return e.price||0})(e);return{...e,price:t,originalPrice:e.price}}));w(e)})()},[m]);return{cartItems:C,orderedItems:y,isLoadingOrders:f,loadCartAndOrders:async()=>{if(l){await D(),h(!0);try{const e=await(async e=>{try{if(!e)return[];const c=t(i,"orders");let d;try{d=a(c,s("userId","==",e),r("orderDate","desc"))}catch(n){d=a(c,s("userId","==",e))}const u=await o(d),p=[];return u.forEach(e=>{const t=e.data();p.push({id:e.id,...t})}),d.toString().includes("orderBy")||p.sort((e,t)=>{const a=e.orderDate?.toDate?e.orderDate.toDate():new Date(e.orderDate);return(t.orderDate?.toDate?t.orderDate.toDate():new Date(t.orderDate)).getTime()-a.getTime()}),p}catch(c){if("permission-denied"===c.code);else if("failed-precondition"===c.code)try{const r=t(i,"orders"),n=a(r,s("userId","==",e)),c=await o(n),d=[];return c.forEach(e=>{const t=e.data();d.push({id:e.id,...t})}),d.sort((e,t)=>{const a=e.orderDate?.toDate?e.orderDate.toDate():new Date(e.orderDate);return(t.orderDate?.toDate?t.orderDate.toDate():new Date(t.orderDate)).getTime()-a.getTime()}),d}catch(d){}return[]}})(l.uid);g(e)}catch(e){}finally{h(!1)}}},getCartImage:e=>"milaf cola"===e.toLowerCase()?p:u(e)}},m=(e=[])=>{n();const t=(()=>{let t=0,a=0,s=0,r=0,o=0,i=0;e.forEach(e=>{const n=e.price*e.quantity;t+=n,a+=e.quantity,!0===e.cases?(s+=n,o+=e.quantity):!0===e.pieces&&(r+=n,i+=e.quantity)});const n=t>=50?0:5.99,c=t+n,d=t>=50?"FREE":`$${n.toFixed(2)}`;return{subtotal:t,shipping:n,total:c,itemCount:a,shippingCharge:d,casesTotal:s,piecesTotal:r,casesCount:o,piecesCount:i}})(),a=e=>`$${e.toFixed(2)}`,s=e=>{if(e>=50)return"";return`Add $${(50-e).toFixed(2)} more for FREE shipping!`};return{processedCartItems:e,orderSummary:t,isLoading:!1,subtotalDisplay:a(t.subtotal),shippingDisplay:0===t.shipping?"shipping address":a(t.shipping),totalDisplay:a(t.total),itemCountDisplay:`${t.itemCount} ${1===t.itemCount?"item":"items"}`,shippingMessage:s(t.subtotal),orderBreakdown:(()=>{const e=[];return t.casesCount>0&&e.push({type:"Cases",count:t.casesCount,total:t.casesTotal,display:`${t.casesCount} case${1===t.casesCount?"":"s"} - ${a(t.casesTotal)}`}),t.piecesCount>0&&e.push({type:"Pieces",count:t.piecesCount,total:t.piecesTotal,display:`${t.piecesCount} piece${1===t.piecesCount?"":"s"} - ${a(t.piecesTotal)}`}),e})(),formatCurrency:a,getShippingMessage:s}};export{m as a,l as u};
